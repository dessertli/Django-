# Django-1
# AXF 

## 闪购数据分类
- 三级联动数据
- 根据左侧进行大类型的分类 （filter根据categoryid）
- 根据右侧小分类进行筛选   （filter根据childcid）
- 让结果集合进行排序   （order_by某一字段）


## 用户模块
- 个人中心
- 用户注册
- 用户登录
- 用户信息修改

### 用户注册
- 用户名
- 密码
- 确认密码
- 邮箱

### 用户信息存储
- 表设计
- id
- 用户名
- 密码
- 邮箱
- 性别
- 逻辑删除


### 编码
- 拒绝中文，空格，特殊字符在我们的路径

### 文件传输
- 文件在网络传输的时候
- 1m 或者更大，数据并不能一次传输过去，就需要将数据分割一个一个的数据包传输到服务器
- 分包方式


### 会话技术
- 网络请求都是短链接
- 请求从request开始到response就结束
- 常用三种
    - cookie
    - session
    - token
    
### 注册用户的时候对密码添加数据安全
- 在注册用户的时候，还有登录的时候
- 用户一注册成功的时候，密码突然变长了


### 完成功能
- 用户注册
    - 实现技术
    - form表单的post提交
    - csrf_token
    - 头像上传，在form中添加 enctype=multipart/form-data
    - 路径千万不要出现非法字符
    - 我们使用了会话技术 session，将用户的唯一标识，存储到session id
- 用户信息
    - 根据用户唯一标识进行获取
    - 查出user，显示user的username，icon
- 用户登录
    - 使用用户名，密码登录
    - 如果用户名或密码错误，没有精准告诉他到底是哪错了
- 数据安全
    - 摘要算法 md5 ，位于hashlib
    - 输入输出都是二进制， encode转换成二进制输入
    - 输出 hexdigest 直接转换成字符串
    - 网络传输也添加了数据安全
    - 使用md5，在传输之前对数据进行转换  
    
    
### 购物车
- 用户和商品的一个对应关系
- 一个用户可以同时购买多种商品
- 一个商品也可以同时被多个用户购买
- 购物车中存储的就是用户和商品的关系
- 用户和商品是一个多对多的关系
    - ManyToManyField
    - 会自动生成多对多的关系表
    - 关系表中使用了两个外键来实现的多对多关系
    - 局限性，定制关系表中的数据，是比较复杂的
- 手动实现多对多的关系
    - 手动实现
    - 两个外键
    - 需要购买的商品数量
    - 商品的选中与未选中状态
- Fields
    - id
    - user_id 用户的主键
    - goods_id 商品的主键 
    - goods_num 商品的数量
    - is_select 此条购物数据是否选中   
- 全选功能
    - 有选中的，也有未选中的，点击全选的时候要将所有的内容选中
    - 全都是选中的，点击全选的时候，应该让所有的都变成未选中
    
#### 订单
- 我们选中部分购物车的商品，将选中的商品发送给服务器，服务器根据商品生成一个订单
- 订单表结构
    - id
    - order_num
    - user
    - status （状态，已下单未付款，已付款未发货，已付款已发货但是没有收货，已收货但未评价，已收货已评价） 
    - time
        - create
        - pay
        - receive
    - 订单包含的购物商品数据
        - 一个订单包含多样商品信息
        - 每一个带着数量的商品只能被一个订单拥有
        - 订单和购买的商品是一对多的关系
- 购物商品表
    - id
    - order_id
    - goods_id  
    - goods_num    
    
    
#### 缓存
- Django内置一套缓存框架
- 并且提供几种默认，还提供了缓存的扩展
- 在什么地方用缓存
    - 在查询条件很复杂的情况下去使用
    - 在变更不频繁的数据上使用缓存
- 缓存时效
    - 针对主页面是缓存了60秒
    - 针对不同的业务逻辑，需要缓存的时间不一样
        - 针对内涵段子（缓存5秒）
        - 针对电影更新（缓存一天）
        
        
#### 项目部署
- Apache
- Nginx
    - 源码非常小  不到1m
    - Http服务器，也是反向代理服务器
- uwsgi  

### 部署过程
- 先部署静态资源
    - static
- 部署动态请求
    - 先直接使用uwsgi部署
    - 修改为socket 和nginx对接
    - 先重启nginx
    - 然后再启动uwsgi
    
  
    
#### 开发者服务器
- 只适合开发使用
- 如果DEBUG开关关闭，就不能提供静态资源
- 只能做动态处理


#### 项目总结
- 分析需求
    - 做什么东西
    - 需要那些技术
    - 需求细化
    - 有哪些模块
- 主页面
    - home （主要是用来显示的）
    - 闪购  （用来查找我们的商品）
    - 购物车
    - 个人中心 （圈用户）
    - 闪购和购物车数据联动
    - 购物车的商品下单，生成订单
        - 订单系统
    - 地址管理
    - 积分系统
    - 会员级别系统
- 开发
    - 首页
        - 不关注业务逻辑
        - 提炼通用模块
        - 底部控制（home，闪购，购物车，我的）
            - 创建base
            - 不同模块创建一个 base_模块
                - base.html
                - base_main.html
                - base_user.html
                - base_order.html
        - 创建每一页
            - 创建主要页面的空页面 （标识）
            - 静态跳转
            - 逐一模块完善
    - 模块完善 home
        - home (展示)
        - 定义模型
        - 数据操作（Views，Controller）
        - 直接查询数据，渲染到模板中
        - 注册路由
    - 模块完善 闪购
        - market
        - 左侧主要分类
        - 右侧顶部 是子分类，排序方式
        - 右侧下部 内容显示区域（核心）
        - 主分类，子分类，排序方式 只是一个条件而已
            - filter(typeid=xx)
            - filter(childcid=xx)
            - order_by("column)
        - 添加到购物车 
    模块完善 （用户）
        - mine
        - 定义模型
            - 用户名（唯一）
            - 密码 （数据安全）
            - 逻辑删除
        - 用户注册
            - 添加数据
            - 预校验
                - ajax
            - 密码一致性验证
            - 格式正则验证
            - 头像
                - ImageField
                - 省去了文件倒流
        - 用户退出
            - 使用了会话技术
            - 清除用户令牌
            - cookie或session  flush会同时清除cookie和session
        - 用户登录
            - 用户名和密码登录服务器
            - 添加一个验证码
    - 模块完善 购物车
        - cart
        - 模型定义
            - 用户
            - 商品
            - 多对多（两个外键）
            - 商品数量
        - 闪购 添加商品
            - 在购物表中添加一条数据
                - 添加的时候注意，如果没有数据，先创建数据
                - 如果有数据，需要在数量上加一
                - 在任何时候，添加的数据前都应该进行一次查询
            - 在购物车减一条数据
                - 先查询数量为一，删除数据就可以
                - 数量大于一，对原数量减去一
        - 购物车中加减
            - 和闪购中是一致的
            - 在数据减到零的时候，需要将页面中展示结果删除
        - 全选
            - 如果有未选中的，全选按钮应该是未选中，点击的时候，所有都变成选中
            - 如果都是选中的，全选按钮默认选中，点击的时候，所有变成未选中
            - 将数据的关键标识存储在html元素上
    - 模块完善 订单
        - 订单
        - 订单应该是用户从购物车中点击下单时生成的
            - 购买的商品 （多个数据）
            - 订单数据
        - 表结构
            - 订单表  （和用户是一个多对一的关系）
            - 订单商品表
                - 数据来自购物车
            - 订单生成过程
                - 生成一个新的订单
                - 生成订单相关联的商品
                - 商品是从购物车表中传递过来
                - 删除购物车中数据
            - 订单流转
                - 订单状态修改
                - 修改某一标识
    - 扩充
        - 积分系统
            - 用户每消费一次，消费金额做积分
        - 地址管理系统
            - 多对一，用户可以限制设置最多十个收货地址
        - 评价系统
            - 评价订单
            - 一对一 
        - 优惠券系统
            - 满100减5块
            - 百分比优惠券
            - 默认帮你选择优惠券（使用优惠最大的）
        - 扩充用户
            - 用户注册完需要激活
                - 用户表中多一个字段  is_active false
                - 注册的时候，在redis中缓存一下用户的唯一标识
                - 给注册者发送一个邮件，邮件的地址中包含唯一标识
                - 服务器发现你请求了这个地址，就根据唯一标识找到用户，修改状态 is_active true
            - 修改密码
                - 需要使用邮件的也是这样做的
    - 优化
        - 加缓存
            - 最推荐使用的就是内存缓存 （CPU中的缓存，RAM(缓存位置)，磁盘（SSD > HDD））
            - Redis （最推荐）
            - Mem
            - 内存缓存
        - 缓存流程
            - 获取数据的时候，首先去缓存中查找
            - 查找到直接进行返回
            - 没有查找到
            - 将数据从数据集中获取出来，将数据筛选，处理，变成我们需求的样子
            - 将数据添加到缓存中
            - 再进行返回
            
            
            
            
            
            
        
            
            
    
 

  
